(()=>{"use strict";var e={29:(e,t,n)=>{let o,r;n.r(t),n.d(t,{deleteDB:()=>v,openDB:()=>b,unwrap:()=>h,wrap:()=>f});const i=new WeakMap,s=new WeakMap,a=new WeakMap,c=new WeakMap,d=new WeakMap;let u={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||a.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function l(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(h(this),e),f(i.get(this))}:function(...e){return f(t.apply(h(this),e))}:function(e,...n){const o=t.call(h(this),e,...n);return a.set(o,e.sort?e.sort():[e]),f(o)}:(e instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),o()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));s.set(e,t)}(e),n=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,u):e);var t,n}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(f(e.result)),o()},i=()=>{n(e.error),o()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&i.set(t,e)})).catch((()=>{})),d.set(t,e),t}(e);if(c.has(e))return c.get(e);const t=l(e);return t!==e&&(c.set(e,t),d.set(t,e)),t}const h=e=>d.get(e);function b(e,t,{blocked:n,upgrade:o,blocking:r,terminated:i}={}){const s=indexedDB.open(e,t),a=f(s);return o&&s.addEventListener("upgradeneeded",(e=>{o(f(s.result),e.oldVersion,e.newVersion,f(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}function v(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(()=>t())),f(n).then((()=>{}))}const p=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],m=new Map;function g(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(m.get(t))return m.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,r=y.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!r&&!p.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let s=i.store;return o&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),r&&i.done]))[0]};return m.set(t,i),i}var D;D=u,u={...D,get:(e,t,n)=>g(e,t)||D.get(e,t,n),has:(e,t)=>!!g(e,t)||D.has(e,t)}},399:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(29);class i{constructor(e,t){this.options=e,this.indexedDb=t,this.upgrade=(e,t,n,o)=>{const r=this.indexedDb.invokeMethod("GetSchema",t,n);if(r&&r.length>0){for(let t of r)if(e.objectStoreNames.contains(t.name)&&o.objectStore(t.name).keyPath!=t.keyPath&&e.deleteObjectStore(t.name),e.objectStoreNames.contains(t.name)){const e=o.objectStore(t.name),n=t.indexes,r=e.indexNames;if(r.length>0)for(let t=0;t<r.length;t++){let o=r[t];n&&n.find((e=>e.name==o))?t++:e.deleteIndex(o)}if(n)for(let t of n)r.contains(t.name)||e.createIndex(t.name,t.keyPath,{unique:t.unique})}else{var i=t.keyPath?{keyPath:t.keyPath}:{autoIncrement:t.autoIncrement};const n=e.createObjectStore(t.name,i);if(t.indexes)for(let e of t.indexes)n.createIndex(e.name,e.keyPath,{unique:e.unique})}this.options.version=n,console.log(`IndexedDB ${this.options.name} has been upgraded from version ${t} to  ${n}.`)}},this.blocked=()=>{this.indexedDb.invokeMethod("OnDbEvent",s.Blocked)},this.blocking=()=>{this.indexedDb.invokeMethod("OnDbEvent",s.Blocking)},this.terminated=()=>{this.indexedDb.invokeMethod("OnDbEvent",s.Terminated)},this.getByKey=(e,t)=>o(this,void 0,void 0,(function*(){const n=this.db.transaction(e,"readonly").objectStore(e);return yield n.get(t)})),this.getAll=e=>o(this,void 0,void 0,(function*(){const t=this.db.transaction(e,"readonly").objectStore(e);return yield t.getAll()})),this.getAllByIndexValue=(e,t,n)=>o(this,void 0,void 0,(function*(){return this.db.getAllFromIndex(e,t,n)})),this.getAllKeysByIndexValue=(e,t,n)=>o(this,void 0,void 0,(function*(){return this.db.getAllKeysFromIndex(e,t,n)})),this.getAllKeys=e=>o(this,void 0,void 0,(function*(){const t=this.db.transaction(e,"readonly").objectStore(e);return yield t.getAllKeys()})),this.count=e=>o(this,void 0,void 0,(function*(){return this.db.count(e)})),this.put=(e,t)=>o(this,void 0,void 0,(function*(){const n=this.db.transaction(e,"readwrite");if(Array.isArray(t)){const e=n.store;for(const n of t)e.put(n)}else n.store.put(t);yield n.done})),this.delete=(e,t)=>o(this,void 0,void 0,(function*(){const n=this.db.transaction(e,"readwrite"),o=n.objectStore(e);if(Array.isArray(t))for(const e of t)o.delete(e);else o.delete(t);return n.complete})),this.clear=e=>o(this,void 0,void 0,(function*(){const t=this.db.transaction(e,"readwrite");return yield t.objectStore(e).clear(),t.complete}))}}var s;!function(e){e[e.Blocked=0]="Blocked",e[e.Blocking=1]="Blocking",e[e.Terminated=2]="Terminated"}(s||(s={})),window.__cbw_idb=new class{initIndexedDb(e,t){return o(this,void 0,void 0,(function*(){console.log(t);const n=new i(e,t);let o=yield r.openDB(e.name,e.version,n);o&&(n.db=o,window[e.indexedDbAgentName]=n)}))}},window.__cbw_js_&&window.__cbw_js_.setLoadedFlag("IndexedDb")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(399)})();